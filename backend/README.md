# ツモ率計算バックエンドサーバー

このプロジェクトは、麻雀の手牌を分析してツモ率とメンツ完成率を計算するRust製バックエンドサーバーです。

## 機能

- 手牌のツモ率計算
- メンツ完成率の計算
- RESTful API エンドポイント

## 必要なファイル

サーバーを起動する前に、以下のファイルが必要です：

- `../converter.dat` - HandConverterのデータファイル
- `../dp/` ディレクトリ内のDPテーブルファイル（将来的に必要）

## 起動方法

```bash
cd backend
cargo run
```

サーバーは `http://127.0.0.1:3000` で起動します。

## API仕様

### ヘルスチェック

```
GET /health
```

**レスポンス:**
```
OK
```

### 手牌分析

```
POST /api/analyze-hand
```

**リクエスト例:**
```json
{
  "hand": "123m456p789s123z"
}
```

**レスポンス例:**
```json
{
  "tsumo_probability": 0.15,
  "mentsu_completion_rate": 0.75
}
```

## 手牌フォーマット

手牌は以下の形式で指定します：

- `m` - 萬子（1-9）
- `p` - 筒子（1-9）
- `s` - 索子（1-9）
- `z` - 字牌（1-7）

**例:**
- `123m456p789s123z` - 1,2,3萬 + 4,5,6筒 + 7,8,9索 + 1,2,3字牌
- `111m222p333s444z` - 1萬3枚 + 2筒3枚 + 3索3枚 + 4字牌3枚

## エラーレスポンス

エラーが発生した場合、以下の形式でレスポンスが返されます：

```json
{
  "error": "エラーメッセージ"
}
```

**主なエラー:**
- `400 Bad Request` - 手牌フォーマットが無効
- `500 Internal Server Error` - サーバー内部エラー

## 開発状況

現在の実装は以下の通りです：

- ✅ 基本的なサーバー構造
- ✅ 手牌パース機能
- ✅ API エンドポイント
- ⚠️ 仮の分析ロジック（実際のDPテーブルを使用する必要あり）
- ⚠️ エラーハンドリング（基本的な実装のみ）

## 今後の改善点

1. 実際のDPテーブルを使用した正確なツモ率計算
2. より詳細な手牌分析機能
3. キャッシュ機能の追加
4. より詳細なエラーハンドリング
5. ログ機能の強化
6. 設定ファイルの追加

## 技術スタック

- **フレームワーク:** Axum
- **非同期ランタイム:** Tokio
- **シリアライゼーション:** Serde
- **CORS:** tower-http
- **ログ:** tracing 